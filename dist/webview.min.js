/*! 12-17-2015 */
function getBookmarksText(a){for(var b=["P","B","I","U","H1","H2","H3","A","PRE","CODE","SPAN"],c=["LINK","STYLE","SCRIPT","NOSCRIPT"],d="",e=a.querySelectorAll("*"),f=0;f<e.length;f++){var g=e[f];(-1!=b.indexOf(g.tagName)||!g.childElementCount&&-1==c.indexOf(g.tagName))&&(d+=" "+g.textContent)}var h=document.querySelector("meta[name=description]");return h&&(d+=" "+h.content),d=d.replace(/[\n\t]/g,"")}function debug_phishing(a){console.log(a)}function checkPhishingStatus(){function a(a){if(a.querySelector("input[type=password]"))return debug_phishing("form with password input found, decreasing threshold"),k*=.7,!0;if(2==a.querySelectorAll("input[type=text], input[type=password]").length)return debug_phishing("possibly sensitive form, checking but increasing minScore"),k*=1.25,!0;if(!a.querySelector("input"))return debug_phishing("empty form found, checking but increasing minScore"),k+=.35,!0;for(var b=a.textContent.toLowerCase(),c=0;c<e.length;c++)if(-1!=b.indexOf(e[c]))return debug_phishing("sensitive word found in form, checking"),k+=.15,!0;return!1}function b(a){var b=a;tldRegex.lastIndex=0;var c=a.split(".");return tldRegex.test(a)&&(b=c[c.length-2]+"."+c[c.length-1]),0==b.indexOf("www.")&&(b=b.replace("www.","")),b}if(!document.querySelector("input[type=password], form"))return!1;var c=performance.now();document.querySelector("input[type=password]")&&(k=.9);for(var d=["secure","account","webscr","login","ebayisapi","signing","banking","confirm"],e=["password","creditcard","credit card","security code","expiration date","card type"],f=["adobeid-na1.services.adobe.com","login.live.com","www.phishtank.com","www.wellsfargo.com","online.citi.com",,"www.bankofamerica.com","my.hrw.com","www.fastcompany.com"],g=0;g<f.length;g++)if(f[g]===window.location.hostname)return;var h=window.location.toString(),i=document.body.textContent,j=document.body.innerHTML,k=1.25,l=0,m=document.createElement("a");doubleDomainRegex.test(h)&&(debug_phishing("found misleading domain"),l+=.0075*window.location.toString().length),"https:"!=window.location.protocol&&(debug_phishing("no https"),l+=.15),window.location.host.length>25&&(debug_phishing("long hostname detected"),l+=.0075*window.location.host.length),h.split("?")[0].length>100&&(debug_phishing("long window location detected"),l+=Math.min(5e-4*window.location.toString().length,.2)),window.location.hostname.split(".").length>3&&(debug_phishing("high number of . characters detected"),l+=Math.min(.03*h.split("?")[0].split(".").length,.2)),window.location.pathname.length>25&&(debug_phishing("paths detected"),l+=Math.min(.05+.002*window.location.pathname.length,.3)),"/"==window.location.pathname&&window.location.hostname.replace("www.","").length<18&&(debug_phishing("short root domain found, increasing minScore"),k+=.3+.05*(18-window.location.hostname.length)),d.forEach(function(a){-1!=h.toLowerCase().indexOf(a)&&(debug_phishing("detected sensitive word found in location"),l+=.025)});var n=document.querySelectorAll("form"),o=0,p=!1,q=!1,r=!1;if(n){for(var g=0;g<n.length;g++){var s=n[g],t=s.textContent;if(a(s)){r=!0;var u=s.getAttribute("action");if(u&&-1==h.split("?")[0].indexOf(u.split("?")[0])){o+=s.innerHTML.length,s.getAttribute("onsubmit")&&(debug_phishing("js html attribute onsubmit detected"),l+=.05);var v=u.replace(window.location.toString(),"").replace(window.location.pathname,"").split("/").length-1;2>v?(debug_phishing("form with simple path for action detected"),q=!0):3>v&&(debug_phishing("non-absolute form path detected"),l+=.1),-1!=u.indexOf(".php")&&(debug_phishing("php file action found"),l+=.075),m.href=u,b(m.hostname)!=b(window.location.hostname)&&(debug_phishing("submitting form to xdomain"),l+=.35),"https:"!=m.protocol&&(debug_phishing("submitting form without https"),l+=.15),d.forEach(function(a){-1!=t.indexOf(a)&&(debug_phishing("sensitive word found in form"),l+=.02)})}else debug_phishing("form without action detected"),p=!0}}1==p&&(l+=.4,l+=Math.min(.2,1e-4*o)),1==q&&(l+=.75)}r||(debug_phishing("no sensitive forms found, increasing minScore"),k+=.1);for(var w=document.querySelectorAll("a, area[href]"),x={},y={},z=0,A=0,g=0;g<w.length;g++){var B=w[g].getAttribute("href");B&&("#"!=B||w[g].onclick)?(0==B.indexOf("javascript:")&&A++,m.href=w[g].href,x[m.host]=x[m.host]+1||1,y[B]=y[B]+1||1):z++}var C=0,D=0,E=b(window.location.host);for(var F in x)if(D+=x[F],b(F)!=E){if(x[F]>4&&F){debug_phishing("found "+x[F]+" links that point to domain "+F),l+=Math.min(.05+.025*x[F],.25);break}}else C+=x[F];(D>2&&0==C||D>5&&.15>C/D)&&(debug_phishing("links go to external domain"),l+=Math.min(.075*(D-C),.5)),(z>5||D>2&&z/D>.5)&&(debug_phishing("counted "+z+" empty links"),l+=Math.min(.02*z,.2)),A>3&&(debug_phishing("counted "+A+" javascript links"),l+=.1);var G=j.length;o>50&&1e3>o&&.075>o/G?(debug_phishing("forms are very minor part of page, increasing minScore"),k+=Math.min(1.15-o/G,1.2)):o>50&&3500>o&&.14>o/G&&(debug_phishing("forms are minor part of page, increasing minScore (small)"),debug_phishing(o),debug_phishing(G),k+=.25);var H=document.querySelectorAll("script"),I={},J=0;if(H)for(var g=0;g<H.length;g++)if(H[g].src){m.href=H[g].src;var E=m.hostname;I[E]=I[E]+1||1,J++}var K=0;for(var L in I)I[L]>2&&I[L]/J>.75&&I[L]<.95&&(l+=.1,debug_phishing("external scripts found, increasing score")),K=I[L];n.length>3&&(k+=Math.min(.05*n.length,.2)),i.length<500&&(debug_phishing("small amount of body text, multiplying score"),l*=1.4);var M=document.querySelector('link[rel="shortcut icon"]');M&&M.href&&(m.href=M.href,b(m.hostname)!=E&&(debug_phishing("icon from external domain found"),l+=.15)),console.log("min "+k),console.log("status",l),l>k&&ipc.sendToHost("phishingDetected");var N=performance.now();return console.log("phishing scan took "+(N-c)+" milliseconds"),!0}function getReaderScore(){var a=document.querySelectorAll("p"),b=0;if(a){for(var c=0;c<a.length;c++)b+=Math.max(a[c].textContent.length-100,-30);return b}}function zoomIn(){webFrame||(webFrame=electron.webFrame),_browser_maxZoom>_browser_zoomLevel&&(_browser_zoomLevel+=1),webFrame.setZoomLevel(_browser_zoomLevel)}function zoomOut(){webFrame||(webFrame=electron.webFrame),_browser_zoomLevel>_browser_minZoom&&(_browser_zoomLevel-=1),webFrame.setZoomLevel(_browser_zoomLevel)}function zoomReset(){webFrame||(webFrame=electron.webFrame),_browser_zoomLevel=0,webFrame.setZoomLevel(_browser_zoomLevel)}function isScrolledIntoView(a){var b=a.getBoundingClientRect().top,c=a.getBoundingClientRect().bottom,d=b<window.innerHeight&&c>=0;return d}function showSourceFile(a){if(1==document.body.childNodes.length){var b=require("js-beautify");"css"==a&&(b=b.css);var c=document.body.textContent;window.highlighter=require("highlight.js");var d=b(c,{indent_size:4});document.body.innerHTML='<style>html,body{margin:0;padding:0;font-size:18px;box-sizing:border-box;font-family:"Courier", monospace}pre{margin:0}.hljs{color:#a9b7c6;background:#282b2e;display:block;overflow-x:auto;padding:.5em;-webkit-text-size-adjust:none;min-height:100vh}.hljs-number{color:#6897BB}.hljs-deletion,.hljs-keyword{color:#cc7832}.hljs-comment{color:grey}.hljs-annotation{color:#bbb529}.hljs-addition,.hljs-string{color:#6A8759}.hljs-change,.hljs-function .hljs-title{color:#ffc66d}.hljs-doctype,.hljs-tag .hljs-title{color:#e8bf6a}.hljs-tag .hljs-attribute{color:#bababa}.hljs-tag .hljs-value{color:#a5c261}</style>',document.body.innerHTML+="<pre><code></code></pre>",document.querySelector("pre > code").textContent=d,highlighter.initHighlighting(),document.head.innerHTML="<link rel='icon' href='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAEElEQVR42gEFAPr/ACgrLv8CgQGB0u9ZtgAAAABJRU5ErkJggg=='/>",document.title=window.location}}function showMarkdownFile(){if(1==document.body.childNodes.length){var a=require("marked"),b=require("highlight.js"),c=document.body.textContent,d=a(c);document.head.innerHTML="<style>body,html{padding:0;margin:0;display:flex;width:100vw;font-family:Helvetica,'.SFNSText-Regular'}.pane{flex:1;overflow:auto;padding:1em}#textPane{margin:0;font-size:15.5px;font-weight:500;border-right:1px #e5e5e5 solid;white-space:pre-wrap;flex:0.8;padding:1.25em;font-family:'Courier', monospace}#previewPane pre{font-size:18px}</style>",document.querySelector("style").innerHTML+="img,pre{display:block}blockquote,p{line-height:1.5em}h1,h2{font-weight:inherit}h3,h4{padding:.5em 0;margin:0;font-size:1.4em;font-weight:500}h4{font-size:1.25em;font-weight:600}.page{padding:2.25rem}img{max-width:100%;height:auto;margin:auto}ol li,ul li{padding:.25rem 0}a{text-decoration:none;color:inherit;font-size:1em;pointer-events:none}figure{max-width:50%;float:right}@media all and (max-width:600px){figure{max-width:100%;float:initial;margin:0}}figure figcaption{padding-top:1em}code,code *,pre,pre *{font-family:monospace}pre{overflow:auto}blockquote{border-left:1px currentColor solid;padding-left:.5em;font-size:1.2em;margin:1.5em 0}",document.querySelector("style").innerHTML+=".hljs{display:block;background:#fff;padding:.5em;color:#333;overflow-x:auto;-webkit-text-size-adjust:none}.bash .hljs-shebang,.hljs-comment,.java .hljs-javadoc,.javascript .hljs-javadoc,.rust .hljs-preprocessor{color:#969896}.apache .hljs-sqbracket,.c .hljs-preprocessor,.coffeescript .hljs-regexp,.coffeescript .hljs-subst,.cpp .hljs-preprocessor,.hljs-string,.javascript .hljs-regexp,.json .hljs-attribute,.less .hljs-built_in,.makefile .hljs-variable,.markdown .hljs-blockquote,.markdown .hljs-emphasis,.markdown .hljs-link_label,.markdown .hljs-strong,.markdown .hljs-value,.nginx .hljs-number,.nginx .hljs-regexp,.objectivec .hljs-preprocessor .hljs-title,.perl .hljs-regexp,.php .hljs-regexp,.scss .hljs-built_in,.xml .hljs-value{color:#df5000}.css .hljs-at_rule,.css .hljs-important,.go .hljs-typename,.haskell .hljs-type,.hljs-keyword,.http .hljs-request,.ini .hljs-setting,.java .hljs-javadoctag,.javascript .hljs-javadoctag,.javascript .hljs-tag,.less .hljs-at_rule,.less .hljs-tag,.nginx .hljs-title,.objectivec .hljs-preprocessor,.php .hljs-phpdoc,.scss .hljs-at_rule,.scss .hljs-important,.scss .hljs-tag,.sql .hljs-built_in,.stylus .hljs-at_rule,.swift .hljs-preprocessor{color:#a71d5d}.apache .hljs-cbracket,.apache .hljs-common,.apache .hljs-keyword,.bash .hljs-built_in,.bash .hljs-literal,.c .hljs-built_in,.c .hljs-number,.coffeescript .hljs-built_in,.coffeescript .hljs-literal,.coffeescript .hljs-number,.cpp .hljs-built_in,.cpp .hljs-number,.cs .hljs-built_in,.cs .hljs-number,.css .hljs-attribute,.css .hljs-function,.css .hljs-hexcolor,.css .hljs-number,.go .hljs-built_in,.go .hljs-constant,.haskell .hljs-number,.http .hljs-attribute,.http .hljs-literal,.java .hljs-number,.javascript .hljs-built_in,.javascript .hljs-literal,.javascript .hljs-number,.json .hljs-number,.less .hljs-attribute,.less .hljs-function,.less .hljs-hexcolor,.less .hljs-number,.makefile .hljs-keyword,.markdown .hljs-link_reference,.nginx .hljs-built_in,.objectivec .hljs-built_in,.objectivec .hljs-literal,.objectivec .hljs-number,.php .hljs-literal,.php .hljs-number,.puppet .hljs-function,.python .hljs-number,.ruby .hljs-constant,.ruby .hljs-number,.ruby .hljs-prompt,.ruby .hljs-subst .hljs-keyword,.ruby .hljs-symbol,.rust .hljs-number,.scss .hljs-attribute,.scss .hljs-function,.scss .hljs-hexcolor,.scss .hljs-number,.scss .hljs-preprocessor,.sql .hljs-number,.stylus .hljs-attribute,.stylus .hljs-hexcolor,.stylus .hljs-number,.stylus .hljs-params,.swift .hljs-built_in,.swift .hljs-number{color:#0086b3}.apache .hljs-tag,.cs .hljs-xmlDocTag,.css .hljs-tag,.stylus .hljs-tag,.xml .hljs-title{color:#63a35c}.bash .hljs-variable,.cs .hljs-preprocessor,.cs .hljs-preprocessor .hljs-keyword,.css .hljs-attr_selector,.css .hljs-value,.ini .hljs-keyword,.ini .hljs-value,.javascript .hljs-tag .hljs-title,.makefile .hljs-constant,.nginx .hljs-variable,.scss .hljs-variable,.xml .hljs-tag{color:#333}.bash .hljs-title,.c .hljs-title,.coffeescript .hljs-title,.cpp .hljs-title,.cs .hljs-title,.css .hljs-class,.css .hljs-id,.css .hljs-pseudo,.diff .hljs-chunk,.haskell .hljs-pragma,.haskell .hljs-title,.ini .hljs-title,.java .hljs-title,.javascript .hljs-title,.less .hljs-class,.less .hljs-id,.less .hljs-pseudo,.makefile .hljs-title,.objectivec .hljs-title,.perl .hljs-sub,.php .hljs-title,.puppet .hljs-title,.python .hljs-decorator,.python .hljs-title,.ruby .hljs-parent,.ruby .hljs-title,.rust .hljs-title,.scss .hljs-class,.scss .hljs-id,.scss .hljs-pseudo,.stylus .hljs-class,.stylus .hljs-id,.stylus .hljs-pseudo,.stylus .hljs-title,.swift .hljs-title,.xml .hljs-attribute{color:#795da3}.coffeescript .hljs-attribute,.coffeescript .hljs-reserved{color:#1d3e81}.diff .hljs-chunk{font-weight:700}.diff .hljs-addition{color:#55a532;background-color:#eaffea}.diff .hljs-deletion{color:#bd2c00;background-color:#ffecec}.markdown .hljs-link_url{text-decoration:underline}",document.body.innerHTML="<pre class='pane' id='textPane'></pre><div class='pane' id='previewPane'></div>";var e={text:document.getElementById("textPane"),preview:document.getElementById("previewPane")};e.text.textContent=c,e.preview.innerHTML=d,b.initHighlighting()}}var electron=require("electron"),ipc=electron.ipcRenderer,webFrame;delete navigator.__proto__.geolocation,delete navigator.__proto__.webkitGetUserMedia,delete navigator.__proto__.getUserMedia,ipc.on("sendData",function(){for(var a=getBookmarksText(document),b=document.querySelectorAll("iframe"),c=0;c<b.length;b++)b[c].contentDocument&&(a+=". "+getBookmarksText(b[c].contentDocument));var d,e,f,g=document.querySelector("[itemprop=price], .price, .offer-price, #priceblock_ourprice, .discounted-price"),h=document.querySelector("[itemprop=priceCurrency], [property=priceCurrency]");g&&(d=g.textContent),/\d/g.test(d)||(d=void 0),d&&-1==d.indexOf("$")&&h&&(d=(h.content||h.textContent).replace("USD","$")+d);var i=document.querySelector('.star-img, .rating, [itemprop="ratingValue"], [property="ratingValue"]');i||(i=document.querySelector('[class^="rating"], [class^="review"]')),i&&(e=i.title||i.alt||i.content||i.textContent,e=e.replace("rating","").replace("stars","").replace("star","").trim(),console.log("r: "+e),e&&/\d+$/g.test(e)&&(e+=" stars"));var j=document.querySelector('[itemprop="location"], [itemprop="address"]');if(!j)var j=document.querySelector(".adr, .addr, .address");j&&(f=j.textContent.trim()),f&&/,?\d{5}$/g.test(f)&&(f=f.replace(/,?\d{5}$/g,"")),console.log("rating: "+e),console.log("price: "+d),console.log("location: "+f),ipc.sendToHost("bookmarksData",{url:window.location.toString(),title:document.title||"",text:a,extraData:{metadata:{price:d,rating:e,location:f}}})});var contextMenuDefaultPrevented=!1;window.addEventListener("contextmenu",function(a){contextMenuDefaultPrevented=a.defaultPrevented}),ipc.on("getContextData",function(a,b){if(!contextMenuDefaultPrevented){var c=document.elementFromPoint(b.x,b.y);if(c){var d=c.href||c.src;if("IMG"==c.tagName||"PICTURE"==c.tagName)var e=c.src}ipc.sendToHost("contextData",{selection:window.getSelection().toString(),src:d,image:e})}});var tldRegex=/\.(com|net|org|edu|gov|mil)$/g,doubleDomainRegex=/\.(com|net|org|edu|gov|mil|uk|ca|jp|fr|au|us|ru|ch|it|nl|de|es)(\.|-).*(com|net|org|edu|gov|mil|uk|ca|jp|fr|au|us|ru|ch|it|nl|de|es)/g,didCheckStatus=!1;window.addEventListener("load",function(){didCheckStatus=!0,setTimeout(checkPhishingStatus,1e3)}),document.addEventListener("DOMContentLoaded",checkPhishingStatus),setTimeout(function(){didCheckStatus||checkPhishingStatus()},2500),window.addEventListener("load",function(a){var b=getReaderScore();(b>650||document.querySelector("article")&&b>200)&&(setTimeout(function(){ipc.sendToHost("canReader")},500),setTimeout(function(){ipc.sendToHost("canReader")},2500))});var totalMouseMove=0,verticalMouseMove=0,eventsCaptured=0,documentUnloaded=!1;window.addEventListener("mousewheel",function(a){return verticalMouseMove+=a.deltaY,eventsCaptured++,verticalMouseMove>55&&a.metaKey&&eventsCaptured>1?(verticalMouseMove=-10,zoomOut()):-55>verticalMouseMove&&a.metaKey&&eventsCaptured>1?(verticalMouseMove=-10,zoomIn()):void(a.deltaY>5||a.deltaY<-10||documentUnloaded||(totalMouseMove+=a.deltaX,-150>totalMouseMove?(doneNavigating=!0,window.history.back(),documentUnloaded=!0,setTimeout(function(){documentUnloaded=!1},3e3)):totalMouseMove>100&&(documentUnloaded=!0,window.history.go(1),setTimeout(function(){documentUnloaded=!1},3e3))))}),setInterval(function(){totalMouseMove=0},4e3),setInterval(function(){verticalMouseMove=0,eventsCaptured=0},1e3);var _browser_zoomLevel=0,_browser_maxZoom=9,_browser_minZoom=-8;ipc.on("zoomIn",zoomIn),ipc.on("zoomOut",zoomOut),ipc.on("zoomReset",zoomReset),ipc.on("getKeywordsData",function(a){function b(a){for(var b=["LINK","STYLE","SCRIPT","NOSCRIPT","svg","symbol","title","path","style"],c="",d=a.querySelectorAll("p, h2, h3, h4, li, [name=author], [itemprop=name], .article-author"),e=window.scrollY,f=0;f<d.length;f++){var g=d[f];if(!(!isScrolledIntoView(d[f])&&a==document||"META"==d[f].tagName&&e>500||d[f].textContent.length<50||d[f].querySelector("time, span, div, menu"))&&-1==b.indexOf(g.tagName)){var h=g.textContent||g.content;c+=d[f-1]&&/\.\s*$/g.test(d[f-1].textContent)?" "+h:". "+h}}return c=c.replace(/[\n\t]/g,"")}if(!(getReaderScore()<400&&-1==window.location.toString().indexOf("reader/index.html"))){var c=b(document),d=document.querySelectorAll("iframe");if(d)for(var e=0;e<d.length;e++)try{c+=" "+b(d[e].contentDocument)}catch(a){}var f=require("nlp_compromise"),g=f.spot(c,{}),h=[];g.forEach(function(a){-1!=a.pos_reason.indexOf("noun_capitalised")&&h.push(a.text.replace(/[^a-zA-Z\s]/g,""))}),ipc.sendToHost("keywordsData",{entities:h})}});for(var filename=window.location.pathname,supportedFileExtensions=["json","js","css"],i=0;i<supportedFileExtensions.length;i++){var index=filename.indexOf("."+supportedFileExtensions[i]);-1!=index&&index==filename.length-(supportedFileExtensions[i].length+1)&&showSourceFile(supportedFileExtensions[i])}for(var markdownFiles=["md","mdown","markdown","markdn","mtext","mdtext","mdwn","mkd","mkdn","text"],i=0;i<markdownFiles.length;i++){var index=filename.indexOf("."+markdownFiles[i]);-1!=index&&index==filename.length-(markdownFiles[i].length+1)&&showMarkdownFile(markdownFiles[i])}