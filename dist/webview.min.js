/*! 12-05-2015 */
function getBookmarksText(a){for(var b=["P","B","I","U","H1","H2","H3","A","PRE","CODE","SPAN"],c=["LINK","STYLE","SCRIPT","NOSCRIPT"],d="",e=a.querySelectorAll("*"),f=0;f<e.length;f++){var g=e[f];(-1!=b.indexOf(g.tagName)||!g.childElementCount&&-1==c.indexOf(g.tagName))&&(d+=" "+g.textContent)}var h=document.querySelector("meta[name=description]");return h&&(d+=" "+h.content),d=d.replace(/[\n\t]/g,"")}function debug_phishing(a){console.log(a)}function checkPhishingStatus(){function a(a){for(var b=a.textContent.toLowerCase(),c=0;c<e.length;c++)if(-1!=b.indexOf(e[c]))return!0;return a.querySelector("input[type=password]")?(debug_phishing("sensitive form found, decresing threshold"),k*=.68,!0):2==a.querySelectorAll("input[type=text], input[type=password]").length?(debug_phishing("possibly sensitive form, checking but increasing minScore"),k*=1.15,!0):a.querySelector("input")?!1:(debug_phishing("empty form found, checking but increasing minScore"),k+=.35,!0)}function b(a){var b=a;tldRegex.lastIndex=0;var c=a.split(".");return tldRegex.test(a)&&(b=c[c.length-2]+"."+c[c.length-1]),0==b.indexOf("www.")&&(b=b.replace("www.","")),b}if(!document.querySelector("input[type=password], form"))return!1;for(var c=performance.now(),d=["secure","account","webscr","login","ebayisapi","signing","banking","confirm"],e=["password","creditcard","credit card","security code","expiration date","card type"],f=["adobeid-na1.services.adobe.com","login.live.com","www.phishtank.com","www.wellsfargo.com","online.citi.com",,"www.bankofamerica.com","my.hrw.com","www.fastcompany.com"],g=0;g<f.length;g++)if(f[g]===window.location.hostname)return;var h=window.location.toString(),i=document.body.textContent,j=document.body.innerHTML,k=1.25,l=0,m=document.createElement("a");doubleDomainRegex.test(h)&&(debug_phishing("found misleading domain"),l+=.33),"https:"!=window.location.protocol&&(debug_phishing("no https"),l+=.15),window.location.host.length>25&&(debug_phishing("long hostname detected"),l+=.0075*window.location.host.length),h.split("?")[0].length>100&&(debug_phishing("long window location detected"),l+=Math.min(5e-4*window.location.toString().length,.2)),h.split("?")[0].split(".").length>5&&(debug_phishing("high number of . characters detected"),l+=Math.min(.03*h.split("?")[0].split(".").length,.2)),window.location.pathname.length>25&&(debug_phishing("paths detected"),l+=Math.min(.05+.002*window.location.pathname.length,.3)),d.forEach(function(a){-1!=h.toLowerCase().indexOf(a)&&(debug_phishing("detected sensitive word found in location"),l+=.025)});var n=document.querySelectorAll("form"),o=0,p=!1,q=!1;if(n){for(var g=0;g<n.length;g++){var r=n[g],s=r.textContent;if(a(r)){var t=r.getAttribute("action");if(t&&-1==h.split("?")[0].indexOf(t.split("?")[0])){o+=r.innerHTML.length,r.getAttribute("onsubmit")&&(debug_phishing("js html attribute onsubmit detected"),l+=.05);var u=t.replace(window.location.toString(),"").replace(window.location.pathname,"").split("/").length-1;2>u?(debug_phishing("form with simple path for action detected"),q=!0):3>u&&(debug_phishing("non-absolute form path detected"),l+=.1),-1!=t.indexOf(".php")&&(debug_phishing("php file action found"),l+=.075),m.href=t,b(m.hostname)!=b(window.location.hostname)&&(debug_phishing("submitting form to xdomain"),l+=.35),"https:"!=m.protocol&&(debug_phishing("submitting form without https"),l+=.15),d.forEach(function(a){-1!=s.indexOf(a)&&(debug_phishing("sensitive word found in form"),l+=.02)})}else debug_phishing("form without action detected"),p=!0}}1==p&&(l+=.4,l+=Math.min(.2,1e-4*o)),1==q&&(l+=.75)}for(var v=document.querySelectorAll("a, area[href]"),w={},x={},y=0,z=0,g=0;g<v.length;g++){var A=v[g].getAttribute("href");A&&("#"!=A||v[g].onclick)?(0==A.indexOf("javascript:")&&z++,m.href=v[g].href,w[m.host]=w[m.host]+1||1,x[A]=x[A]+1||1):y++}var B=0,C=0,D=b(window.location.host);for(var E in w)if(C+=w[E],b(E)!=D){if(w[E]>4&&E){debug_phishing("found "+w[E]+" links that point to domain "+E),l+=Math.min(.05+.025*w[E],.4);break}}else B+=w[E];(C>2&&0==B||C>5&&.15>B/C)&&(debug_phishing("links go to external domain"),l+=Math.min(.05*(C-B),.25)),(y>5||C>2&&y/C>.5)&&(debug_phishing("counted "+y+" empty links"),l+=Math.min(.02*y,.2)),z>3&&(debug_phishing("counted "+z+" javascript links"),l+=.1),document.querySelector("input[type=password]")&&(k=.9);var F=j.length;o>50&&1e3>o&&.075>o/F?(debug_phishing("forms are very minor part of page, increasing minScore"),k+=Math.min(1.1-o/F,1.1)):o>50&&3500>o&&.14>o/F&&(debug_phishing("forms are minor part of page, increasing minScore (small)"),debug_phishing(o),debug_phishing(F),k+=.2);var G=document.querySelectorAll("script"),H={};if(G)for(var g=0;g<G.length;g++)if(G[g].src){m.href=G[g].src;var D=m.hostname;H[D]=H[D]+1||1}var I=0;for(var J in H)H[J]>5&&I>0&&(l+=.1,debug_phishing("external scripts found, increasing score")),I=H[J];n.length>3&&(k+=Math.min(.05*n.length,.2)),i.length<500&&(debug_phishing("small amount of body text, multiplying score"),l*=1.4),console.log("min "+k),console.log("status",l,n,x,w),l>k&&ipc.sendToHost("phishingDetected");var K=performance.now();return console.log("phishing scan took "+(K-c)+" milliseconds"),!0}function getReaderScore(){var a=document.querySelectorAll("p"),b=0;if(a){for(var c=0;c<a.length;c++)b+=Math.max(a[c].textContent.length-100,-30);return b}}function isScrolledIntoView(a){var b=a.getBoundingClientRect().top,c=a.getBoundingClientRect().bottom,d=b<window.innerHeight&&c>=0;return d}function showSourceFile(a){if(1==document.body.childNodes.length){var b=require("js-beautify");"css"==a&&(b=b.css);var c=document.body.textContent;window.highlighter=require("highlight.js");var d=b(c,{indent_size:4});document.body.innerHTML='<style>html,body{margin:0;padding:0;font-size:18px;box-sizing:border-box;font-family:"Courier", monospace}pre{margin:0}.hljs{color:#a9b7c6;background:#282b2e;display:block;overflow-x:auto;padding:.5em;-webkit-text-size-adjust:none;min-height:100vh}.hljs-number{color:#6897BB}.hljs-deletion,.hljs-keyword{color:#cc7832}.hljs-comment{color:grey}.hljs-annotation{color:#bbb529}.hljs-addition,.hljs-string{color:#6A8759}.hljs-change,.hljs-function .hljs-title{color:#ffc66d}.hljs-doctype,.hljs-tag .hljs-title{color:#e8bf6a}.hljs-tag .hljs-attribute{color:#bababa}.hljs-tag .hljs-value{color:#a5c261}</style>',document.body.innerHTML+="<pre><code></code></pre>",document.querySelector("pre > code").textContent=d,highlighter.initHighlighting(),document.head.innerHTML="<link rel='icon' href='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAEElEQVR42gEFAPr/ACgrLv8CgQGB0u9ZtgAAAABJRU5ErkJggg=='/>",document.title=window.location}}function showMarkdownFile(){if(1==document.body.childNodes.length){var a=require("marked"),b=require("highlight.js"),c=document.body.textContent,d=a(c);document.head.innerHTML="<style>body,html{padding:0;margin:0;display:flex;width:100vw;font-family:Helvetica,'.SFNSText-Regular'}.pane{flex:1;overflow:auto;padding:1em}#textPane{margin:0;font-size:15.5px;font-weight:500;border-right:1px #e5e5e5 solid;white-space:pre-wrap;flex:0.8;padding:1.25em;font-family:'Courier', monospace}#previewPane pre{font-size:18px}</style>",document.querySelector("style").innerHTML+="img,pre{display:block}blockquote,p{line-height:1.5em}h1,h2{font-weight:inherit}h3,h4{padding:.5em 0;margin:0;font-size:1.4em;font-weight:500}h4{font-size:1.25em;font-weight:600}.page{padding:2.25rem}img{max-width:100%;height:auto;margin:auto}ol li,ul li{padding:.25rem 0}a{text-decoration:none;color:inherit;font-size:1em;pointer-events:none}figure{max-width:50%;float:right}@media all and (max-width:600px){figure{max-width:100%;float:initial;margin:0}}figure figcaption{padding-top:1em}code,code *,pre,pre *{font-family:monospace}pre{overflow:auto}blockquote{border-left:1px currentColor solid;padding-left:.5em;font-size:1.2em;margin:1.5em 0}",document.querySelector("style").innerHTML+=".hljs{display:block;background:#fff;padding:.5em;color:#333;overflow-x:auto;-webkit-text-size-adjust:none}.bash .hljs-shebang,.hljs-comment,.java .hljs-javadoc,.javascript .hljs-javadoc,.rust .hljs-preprocessor{color:#969896}.apache .hljs-sqbracket,.c .hljs-preprocessor,.coffeescript .hljs-regexp,.coffeescript .hljs-subst,.cpp .hljs-preprocessor,.hljs-string,.javascript .hljs-regexp,.json .hljs-attribute,.less .hljs-built_in,.makefile .hljs-variable,.markdown .hljs-blockquote,.markdown .hljs-emphasis,.markdown .hljs-link_label,.markdown .hljs-strong,.markdown .hljs-value,.nginx .hljs-number,.nginx .hljs-regexp,.objectivec .hljs-preprocessor .hljs-title,.perl .hljs-regexp,.php .hljs-regexp,.scss .hljs-built_in,.xml .hljs-value{color:#df5000}.css .hljs-at_rule,.css .hljs-important,.go .hljs-typename,.haskell .hljs-type,.hljs-keyword,.http .hljs-request,.ini .hljs-setting,.java .hljs-javadoctag,.javascript .hljs-javadoctag,.javascript .hljs-tag,.less .hljs-at_rule,.less .hljs-tag,.nginx .hljs-title,.objectivec .hljs-preprocessor,.php .hljs-phpdoc,.scss .hljs-at_rule,.scss .hljs-important,.scss .hljs-tag,.sql .hljs-built_in,.stylus .hljs-at_rule,.swift .hljs-preprocessor{color:#a71d5d}.apache .hljs-cbracket,.apache .hljs-common,.apache .hljs-keyword,.bash .hljs-built_in,.bash .hljs-literal,.c .hljs-built_in,.c .hljs-number,.coffeescript .hljs-built_in,.coffeescript .hljs-literal,.coffeescript .hljs-number,.cpp .hljs-built_in,.cpp .hljs-number,.cs .hljs-built_in,.cs .hljs-number,.css .hljs-attribute,.css .hljs-function,.css .hljs-hexcolor,.css .hljs-number,.go .hljs-built_in,.go .hljs-constant,.haskell .hljs-number,.http .hljs-attribute,.http .hljs-literal,.java .hljs-number,.javascript .hljs-built_in,.javascript .hljs-literal,.javascript .hljs-number,.json .hljs-number,.less .hljs-attribute,.less .hljs-function,.less .hljs-hexcolor,.less .hljs-number,.makefile .hljs-keyword,.markdown .hljs-link_reference,.nginx .hljs-built_in,.objectivec .hljs-built_in,.objectivec .hljs-literal,.objectivec .hljs-number,.php .hljs-literal,.php .hljs-number,.puppet .hljs-function,.python .hljs-number,.ruby .hljs-constant,.ruby .hljs-number,.ruby .hljs-prompt,.ruby .hljs-subst .hljs-keyword,.ruby .hljs-symbol,.rust .hljs-number,.scss .hljs-attribute,.scss .hljs-function,.scss .hljs-hexcolor,.scss .hljs-number,.scss .hljs-preprocessor,.sql .hljs-number,.stylus .hljs-attribute,.stylus .hljs-hexcolor,.stylus .hljs-number,.stylus .hljs-params,.swift .hljs-built_in,.swift .hljs-number{color:#0086b3}.apache .hljs-tag,.cs .hljs-xmlDocTag,.css .hljs-tag,.stylus .hljs-tag,.xml .hljs-title{color:#63a35c}.bash .hljs-variable,.cs .hljs-preprocessor,.cs .hljs-preprocessor .hljs-keyword,.css .hljs-attr_selector,.css .hljs-value,.ini .hljs-keyword,.ini .hljs-value,.javascript .hljs-tag .hljs-title,.makefile .hljs-constant,.nginx .hljs-variable,.scss .hljs-variable,.xml .hljs-tag{color:#333}.bash .hljs-title,.c .hljs-title,.coffeescript .hljs-title,.cpp .hljs-title,.cs .hljs-title,.css .hljs-class,.css .hljs-id,.css .hljs-pseudo,.diff .hljs-chunk,.haskell .hljs-pragma,.haskell .hljs-title,.ini .hljs-title,.java .hljs-title,.javascript .hljs-title,.less .hljs-class,.less .hljs-id,.less .hljs-pseudo,.makefile .hljs-title,.objectivec .hljs-title,.perl .hljs-sub,.php .hljs-title,.puppet .hljs-title,.python .hljs-decorator,.python .hljs-title,.ruby .hljs-parent,.ruby .hljs-title,.rust .hljs-title,.scss .hljs-class,.scss .hljs-id,.scss .hljs-pseudo,.stylus .hljs-class,.stylus .hljs-id,.stylus .hljs-pseudo,.stylus .hljs-title,.swift .hljs-title,.xml .hljs-attribute{color:#795da3}.coffeescript .hljs-attribute,.coffeescript .hljs-reserved{color:#1d3e81}.diff .hljs-chunk{font-weight:700}.diff .hljs-addition{color:#55a532;background-color:#eaffea}.diff .hljs-deletion{color:#bd2c00;background-color:#ffecec}.markdown .hljs-link_url{text-decoration:underline}",document.body.innerHTML="<pre class='pane' id='textPane'></pre><div class='pane' id='previewPane'></div>";var e={text:document.getElementById("textPane"),preview:document.getElementById("previewPane")};e.text.textContent=c,e.preview.innerHTML=d,b.initHighlighting()}}var electron=require("electron"),ipc=electron.ipcRenderer,webFrame=electron.webFrame;delete navigator.__proto__.geolocation,delete navigator.__proto__.webkitGetUserMedia,delete navigator.__proto__.getUserMedia,ipc.on("sendData",function(){for(var a=getBookmarksText(document),b=document.querySelectorAll("iframe"),c=0;c<b.length;b++)b[c].contentDocument&&(a+=". "+getBookmarksText(b[c].contentDocument));var d,e,f,g=document.querySelector("[itemprop=price], .price, .offer-price, #priceblock_ourprice, .discounted-price"),h=document.querySelector("[itemprop=priceCurrency], [property=priceCurrency]");g&&(d=g.textContent),/\d/g.test(d)||(d=void 0),d&&-1==d.indexOf("$")&&h&&(d=(h.content||h.textContent).replace("USD","$")+d);var i=document.querySelector('.star-img, .rating, [itemprop="ratingValue"], [property="ratingValue"]');i||(i=document.querySelector('[class^="rating"], [class^="review"]')),i&&(e=i.title||i.alt||i.content||i.textContent,e=e.replace("rating","").replace("stars","").replace("star","").trim(),console.log("r: "+e),e&&/\d+$/g.test(e)&&(e+=" stars"));var j=document.querySelector('[itemprop="location"], [itemprop="address"]');if(!j)var j=document.querySelector(".adr, .addr, .address");j&&(f=j.textContent.trim()),f&&/,?\d{5}$/g.test(f)&&(f=f.replace(/,?\d{5}$/g,"")),console.log("rating: "+e),console.log("price: "+d),console.log("location: "+f),ipc.sendToHost("bookmarksData",{url:window.location.toString(),title:document.title||"",text:a,extraData:{metadata:{price:d,rating:e,location:f}}})});var contextMenuDefaultPrevented=!1;window.addEventListener("contextmenu",function(a){contextMenuDefaultPrevented=a.defaultPrevented}),ipc.on("getContextData",function(a,b){if(!contextMenuDefaultPrevented){var c=document.elementFromPoint(b.x,b.y);if(c){var d=c.href||c.src;if("IMG"==c.tagName||"PICTURE"==c.tagName)var e=c.src}ipc.sendToHost("contextData",{selection:window.getSelection().toString(),src:d,image:e})}});var tldRegex=/\.(com|net|org|edu|gov|mil)$/g,doubleDomainRegex=/\.(com|net|org|edu|gov|mil|uk|ca|jp|fr|au|us|ru|ch|it|nl|de|es)(\.|-).*(com|net|org|edu|gov|mil|uk|ca|jp|fr|au|us|ru|ch|it|nl|de|es)/g;window.addEventListener("load",function(){setTimeout(checkPhishingStatus,1e3)}),document.addEventListener("DOMContentLoaded",checkPhishingStatus),window.addEventListener("load",function(a){var b=getReaderScore();(b>650||document.querySelector("article")&&b>200)&&(setTimeout(function(){ipc.sendToHost("canReader")},500),setTimeout(function(){ipc.sendToHost("canReader")},2500))});var totalMouseMove=0,documentUnloaded=!1;window.addEventListener("mousewheel",function(a){a.deltaY>10||a.deltaY<-10||documentUnloaded||(totalMouseMove+=a.deltaX,-150>totalMouseMove?(doneNavigating=!0,window.history.back(),documentUnloaded=!0,console.log("going back"),setTimeout(function(){documentUnloaded=!1},3e3)):totalMouseMove>100&&(console.log("going forward"),documentUnloaded=!0,window.history.go(1),console.log(a),setTimeout(function(){documentUnloaded=!1},3e3)))}),setInterval(function(){totalMouseMove=0},4e3);var _browser_zoomLevel=0,_browser_maxZoom=9,_browser_minZoom=-8;ipc.on("zoomIn",function(){_browser_maxZoom>_browser_zoomLevel&&(_browser_zoomLevel+=1),webFrame.setZoomLevel(_browser_zoomLevel)}),ipc.on("zoomOut",function(){_browser_zoomLevel>_browser_minZoom&&(_browser_zoomLevel-=1),webFrame.setZoomLevel(_browser_zoomLevel)}),ipc.on("zoomReset",function(){_browser_zoomLevel=0,webFrame.setZoomLevel(_browser_zoomLevel)}),ipc.on("getKeywordsData",function(a){function b(a){for(var b=["LINK","STYLE","SCRIPT","NOSCRIPT","svg","symbol","title","path","style"],c="",d=a.querySelectorAll("p, h2, h3, h4, li, [name=author], [itemprop=name], .article-author"),e=0;e<d.length;e++)if(!(!isScrolledIntoView(d[e])&&a==document||"none"==d[e].style.display||"META"==d[e].tagName&&window.scrollY>500)){var f=d[e];if(-1==b.indexOf(f.tagName)){var g=f.textContent||f.content;c+=/\.\s*$/g.test(g)?" "+g:". "+g}}return c=c.replace(/[\n\t]/g,"")}if(!(getReaderScore()<400&&-1==window.location.toString().indexOf("reader/index.html"))){var c=b(document),d=document.querySelectorAll("iframe");if(d)for(var e=0;e<d.length;e++)d[e].contentDocument&&(c+=" "+b(d[e].contentDocument));var f=require("nlp_compromise"),g=f.spot(c,{}),h=[];g.forEach(function(a){-1!=a.pos_reason.indexOf("noun_capitalised")&&h.push(a.text.replace(/[^a-zA-Z\s]/g,""))}),ipc.sendToHost("keywordsData",{entities:h})}});for(var filename=window.location.pathname,supportedFileExtensions=["json","js","css"],i=0;i<supportedFileExtensions.length;i++){var index=filename.indexOf("."+supportedFileExtensions[i]);-1!=index&&index==filename.length-(supportedFileExtensions[i].length+1)&&showSourceFile(supportedFileExtensions[i])}for(var markdownFiles=["md","mdown","markdown","markdn","mtext","mdtext","mdwn","mkd","mkdn","text"],i=0;i<markdownFiles.length;i++){var index=filename.indexOf("."+markdownFiles[i]);-1!=index&&index==filename.length-(markdownFiles[i].length+1)&&showMarkdownFile(markdownFiles[i])}