/*! 01-08-2016 */
function bindWebviewEvent(a,b){webviewEvents.push({event:a,fn:b})}function bindWebviewIPC(a,b){webviewIPC.push({name:a,fn:b})}function getWebviewDom(a){var b=(a||{}).url||"about:blank",c=$("<webview>");return c.attr("preload","dist/webview.min.js"),c.attr("src",urlParser.parse(b)),c.attr("data-tab",a.tabId),1==tabs.get(a.tabId)["private"]&&c.attr("partition",a.tabId),webviewEvents.forEach(function(a){c.on(a.event,a.fn)}),c.on("page-favicon-updated",function(a){var b=$(this).attr("data-tab");updateTabColor(a.originalEvent.favicons,b)}),c.on("page-title-set",function(a){var b=$(this).attr("data-tab");tabs.update(b,{title:a.originalEvent.title}),rerenderTabElement(b)}),c.on("did-finish-load",function(a){var b=$(this).attr("data-tab"),c=$(this).attr("src");0===c.indexOf("https://")||0==c.indexOf("about:")||0==c.indexOf("chrome:")||0==c.indexOf("file://")?tabs.update(b,{secure:!0,url:c}):tabs.update(b,{secure:!1,url:c});var d=-1!=c.indexOf(__dirname)&&-1==c.indexOf(readerView.readerURL);0!=tabs.get(b)["private"]||d||bookmarks.updateHistory(b),rerenderTabElement(b),this.send("loadfinish")}),c.on("new-window",function(a){var b=$(this).attr("data-tab"),c=tabs.getIndex(tabs.getSelected()),d=tabs.add({url:a.originalEvent.url,"private":tabs.get(b)["private"]},c+1);addTab(d,{focus:!1,openInBackground:"background-tab"==a.originalEvent.disposition})}),c.on("ipc-message",function(a){var b=this,c=$(this).attr("data-tab");webviewIPC.forEach(function(d){d.name==a.originalEvent.channel&&d.fn(b,c,a.originalEvent.args)}),"bookmarksData"==a.originalEvent.channel?bookmarks.onDataRecieved(a.originalEvent.args[0]):"phishingDetected"==a.originalEvent.channel&&navigate($(this).attr("data-tab"),phishingWarningPage)}),c.on("contextmenu",webviewMenu.show),c.on("crashed",function(a){var b=$(this).attr("data-tab");destroyWebview(b),tabs.update(b,{url:crashedWebviewPage}),addWebview(b),switchToWebview(b)}),c.on("did-fail-load",function(a){-3!=a.originalEvent.errorCode&&a.originalEvent.validatedURL==a.target.getURL()&&navigate($(this).attr("data-tab"),errorPage+"?ec="+encodeURIComponent(a.originalEvent.errorCode)+"&url="+a.target.getURL())}),c}function addWebview(a){var b=tabs.get(a),c=getWebviewDom({tabId:a,url:b.url});c.addClass("hidden"),webviewBase.append(c)}function switchToWebview(a,b){$("webview").prop("hidden",!0);var c=getWebview(a);c.removeClass("hidden").prop("hidden",!1),b&&b.focus&&c[0].focus()}function updateWebview(a,b){getWebview(a).attr("src",urlParser.parse(b))}function destroyWebview(a){$('webview[data-tab="{id}"]'.replace("{id}",a)).remove()}function getWebview(a){return $('webview[data-tab="{id}"]'.replace("{id}",a))}function navigate(a,b){b=urlParser.parse(b),tabs.update(a,{url:b}),updateWebview(a,b),leaveTabEditMode({blur:!0})}function switchToNextTab(a){var b=tabs.getAtIndex(a+1)||tabs.getAtIndex(a-1);b&&switchToTab(b.id)}function destroyTab(a){getTabElement(a).remove();tabs.destroy(a);destroyWebview(a)}function switchToTab(a){if(isFocusMode)return void showFocusModeError();leaveTabEditMode(),setActiveTabElement(a),switchToWebview(a,{focus:!isExpandedMode}),tabs.setSelected(a);var b=tabs.get(a);setColor(b.backgroundColor,b.foregroundColor),setTimeout(function(){tabs.get(a)&&tabs.getSelected()==a&&(tabs.update(a,{lastActivity:Date.now()}),tabActivity.refresh())},2500),sessionRestore.save()}function searchbarAutocomplete(a,b,c){if(!a)return void(currentACItem=null);if((a!=searchbarCachedText||b[0].selectionStart==b[0].selectionEnd)&&!didFireKeydownSelChange)for(var d=!1,e=0;!d&&e<c.length;e++)d=autocompleteResultIfNeeded(b,c[e])}function autocompleteResultIfNeeded(a,b){DDGSearchURLRegex.lastIndex=0,shouldAutocompleteTitle=DDGSearchURLRegex.test(b.url),shouldAutocompleteTitle&&(b.title=decodeURIComponent(b.url.replace(DDGSearchURLRegex,"$1").replace(plusRegex," ")));var c=getValue(a),d=new URL(b.url).hostname,e=[d,(d+"/").replace(urlParser.startingWWWRegex,"$1").replace("/",""),urlParser.prettyURL(b.url),urlParser.removeProtocol(b.url),b.url];shouldAutocompleteTitle&&e.push(b.title);for(var f=0;f<e.length;f++)if(!deleteKeyPressed&&0==e[f].toLowerCase().indexOf(c.toLowerCase())){if(a.val(e[f]),a.get(0).setSelectionRange(c.length,e[f].length),2>f){var g=new URL(b.url);currentACItem=g.protocol+"//"+g.hostname+"/"}else currentACItem=b.url;return!0}return currentACItem=null,!1}function limitHistoryResults(a){maxHistoryResults=Math.min(4,Math.max(a,2)),historyarea.find(".result-item:nth-child(n+{items})".replace("{items}",maxHistoryResults+1)).prop("hidden",!0).addClass("unfocusable")}function addBookmarkItem(a){var b=$("<div class='result-item' tabindex='-1'>").append($("<span class='title'>").text(getRealTitle(a.title))).on("click",function(b){openURLFromsearchbar(b,a.url)});$("<i class='fa fa-star'>").prependTo(b);var c=$("<span class='secondary-text'>").text(urlParser.prettyURL(a.url));if(a.extraData&&a.extraData.metadata){var d=[];a.extraData.metadata.rating&&d.push($("<span class='md-info'>").text(a.extraData.metadata.rating)),a.extraData.metadata.price&&d.push($("<span class='md-info'>").text(a.extraData.metadata.price)),a.extraData.metadata.location&&d.push($("<span class='md-info'>").text(a.extraData.metadata.location)),d.reverse().forEach(function(a){c.prepend(a)})}c.appendTo(b),b.appendTo(bookmarkarea),b.attr("data-url",a.url)}function throttle(a,b,c){b||(b=250);var d,e;return function(){var f=c||this,g=+new Date,h=arguments;d&&d+b>g?(clearTimeout(e),e=setTimeout(function(){d=g,a.apply(f,h)},b)):(d=g,a.apply(f,h))}}function debounce(a,b){var c=null;return function(){var d=this,e=arguments;clearTimeout(c),c=setTimeout(function(){a.apply(d,e)},b)}}function removeTags(a){return a.replace(/<.*?>/g,"")}function parsesearchbarURL(a){return 0==a.indexOf("?")&&(a=urlParser.searchBaseURL.replace("%s",encodeURIComponent(a.replace("?","")))),0==a.indexOf("^")&&(a=a.replace("^","")),0==a.indexOf("*")&&(a=a.replace("*","")),a}function openURLInBackground(a){var b=tabs.add({url:a,"private":tabs.get(tabs.getSelected())["private"]},tabs.getIndex(tabs.getSelected())+1);addTab(b,{focus:!1,openInBackground:!0,leaveEditMode:!1}),$(".result-item:focus").blur()}function openURLFromsearchbar(a,b){return a.metaKey?(openURLInBackground(b),!0):(navigate(tabs.getSelected(),b),!1)}function getRealTitle(a){if(urlParser.isURL(a))return a;for(var b=["|",":"," - "," â€” "],c=0;c<b.length;c++){var d=b[c],e=a.split(d);if(e.length>=2&&(e[0]=e[0].trim(),e[1]=e[1].trim(),e[1].length<5||e[1].length/e[0].length<=.5))return e[0]}return a}function clearsearchbar(){opentabarea.empty(),topAnswerarea.empty(),bookmarkarea.empty(),historyarea.empty(),iaarea.empty(),suggestedsitearea.empty(),serarea.empty(),cachedBangSnippets=[]}function showSearchbar(a){searchbarCachedText=a.val(),$(document.body).addClass("searchbar-shown"),clearsearchbar(),searchbar.prop("hidden",!1),currentsearchbarInput=a}function getValue(a){var b=a.val();return b.replace(b.substring(a[0].selectionStart,a[0].selectionEnd),"")}function hidesearchbar(){currentsearchbarInput=null,$(document.body).removeClass("searchbar-shown"),searchbar.prop("hidden",!0),cachedBangSnippets={}}function focussearchbarItem(a){a=a||{};var b=a.focusPrevious,c=$("#searchbar .result-item:not(.unfocusable)"),d=$("#searchbar .result-item:focus, .result-item.fakefocus"),e=c.index(d),f=c.eq(b?e-1:e+1);searchbar.find(".fakefocus").removeClass("fakefocus"),d[0]&&f[0]?f.get(0).focus():d[0]?getTabElement(tabs.getSelected()).getInput().get(0).focus():$("#searchbar .result-item").first().get(0).focus();var g=$("#searchbar .result-item:focus");g.hasClass("iadata-onfocus")&&setTimeout(function(){if(g.is(":focus")){var a=g.find(".title").text();showInstantAnswers(a,currentsearchbarInput,{alwaysShow:!0,destroyPrevious:!1})}},200)}function getColor(a,b){colorExtractorImage.onload=function(a){var c=document.createElement("canvas"),d=c.getContext("2d"),e=colorExtractorImage.width,f=colorExtractorImage.height;c.width=e,c.height=f;var g=Math.max(1,Math.round(32e-5*e*f));d.drawImage(colorExtractorImage,0,0,e,f);for(var h,i,j,k=d.getImageData(0,0,e,f).data,l={},m=0;m<k.length;m+=4*g)h=5*Math.round(k[m]/5)+","+5*Math.round(k[m+1]/5)+","+5*Math.round(k[m+2]/5),i=1,j=k[m]+k[m+1]+k[m+2],310>j&&(i=.35),50>j&&(i=.01),(k[m]>210||k[m+1]>210||k[m+2]>210)&&(i=.5-1e-4*j),l[h]?l[h]=l[h]+i:l[h]=i;var n=null,o=0;for(var p in l)("255,255,255"==p||"0,0,0"==p)&&(l[p]*=.05),l[p]>o&&(n=p,o=l[p]);for(var q=n.split(","),m=0;m<q.length;m++)q[m]=parseInt(q[m]);b(q)},colorExtractorImage.src=a}function updateTabColor(a,b){return 1==tabs.get(b)["private"]?(tabs.update(b,{backgroundColor:"#3a2c63",foregroundColor:"white"}),void(b==tabs.getSelected()&&setColor("#3a2c63","white"))):void requestIdleCallback(function(){getColor(a[0],function(a){var c=1;hours>20?c-=.015*Math.pow(2.75,hours-20):6.5>hours&&(c-=-.15*Math.pow(1.36,hours)+1.15),a[0]=Math.round(a[0]*c),a[1]=Math.round(a[1]*c),a[2]=Math.round(a[2]*c);var d="rgb("+a[0]+","+a[1]+","+a[2]+")",e={r:a[0]/255,g:a[1]/255,b:a[2]/255},f=getTextColor(e);tabs.update(b,{backgroundColor:d,foregroundColor:f}),b==tabs.getSelected()&&setColor(d,f)})},{timeout:1e3})}function setColor(a,b){$(".theme-background-color").css("background-color",a),$(".theme-text-color").css("color",b),"white"==b?$(document.body).addClass("dark-theme"):$(document.body).removeClass("dark-theme")}function getTabElement(a){return $('.tab-item[data-tab="{id}"]'.replace("{id}",a))}function setActiveTabElement(a){$(".tab-item.active").removeClass("active");var b=getTabElement(a);b.addClass("active"),tabs.count()>1?b.addClass("has-highlight"):b.removeClass("has-highlight"),isExpandedMode||requestIdleCallback(function(){b[0].scrollIntoView({behavior:"smooth"})},{timeout:1e3})}function leaveTabEditMode(a){$(".tab-item.selected").removeClass("selected"),a&&a.blur&&$(".tab-item .tab-input").blur(),tabGroup.removeClass("has-selected-tab"),hidesearchbar()}function enterEditMode(a){leaveExpandedMode();var b=getTabElement(a),c=getWebview(a)[0],d=c.getAttribute("src");"about:blank"==d&&(d="");var e=b.getInput();b.addClass("selected"),e.val(d),e.get(0).focus(),e.select(),showSearchbar(e),showSearchbarResults("",e,null),tabGroup.addClass("has-selected-tab");try{getWebview(tabs.getSelected())[0].send("getKeywordsData")}catch(f){}}function rerenderTabElement(a){var b=getTabElement(a),c=tabs.get(a),d=c.title||"New Tab";b.find(".tab-view-contents .title").text(d).attr("title",d);var e=b[0].getElementsByClassName("icon-tab-not-secure");c.secure===!1?e[0]||b.find(".tab-view-contents").prepend("<i class='fa fa-exclamation-triangle icon-tab-not-secure' title='Your connection to this website is not secure.'></i>"):e[0]&&e[0].parentNode.removeChild(e[0]),bookmarks.renderStar(a,b.find(".bookmarks-button"))}function createTabElement(a){var b=tabs.get(a),c=urlParser.parse(b.url),d=$("<div class='tab-item'>");d.attr("data-tab",a),b["private"]&&d.addClass("private-tab");var e=$("<div class='tab-edit-contents'>"),f=$("<input class='tab-input mousetrap'>");f.attr("placeholder","Search or enter address"),f.attr("value",c),f.appendTo(e),bookmarks.getStar(a).appendTo(e),e.appendTo(d);var g=$("<div class='tab-view-contents'>");return readerView.getButton(a).appendTo(g),b["private"]&&g.prepend("<i class='fa fa-ban icon-tab-is-private'></i>").attr("title","Private tab"),g.append($("<span class='title'>").text(b.title||"New Tab")),g.append("<span class='secondary-text'></span>"),g.appendTo(d),f.on("keydown",function(a){(9==a.keyCode||40==a.keyCode)&&(focussearchbarItem(),a.preventDefault())}),f.on("keyup",function(a){8==a.keyCode&&showSearchbarResults($(this).val(),$(this),a)}),f.on("keypress",function(a){if(13==a.keyCode){var b=$(this).parents(".tab-item").attr("data-tab"),c=parsesearchbarURL($(this).val());navigate(b,c),leaveTabEditMode(b),getWebview(tabs.getSelected())[0].focus()}else{if(9==a.keyCode)return;if(16==a.keyCode)return;if(8==a.keyCode)return;showSearchbarResults($(this).val(),$(this),a)}var d=String.fromCharCode(a.keyCode).toLowerCase(),e=this.value.substring(this.selectionStart,this.selectionEnd).indexOf(d);return d&&0==e?(this.selectionStart+=1,didFireKeydownSelChange=!0,!1):void(didFireKeydownSelChange=!1)}),f.on("click",function(a){a.stopPropagation()}),d}function addTab(a,b){b=b||{},0!=b.leaveEditMode&&leaveTabEditMode(),a=a||tabs.add();var c=tabs.get(a);c["private"]&&!c.backgroundColor?tabs.update(a,{backgroundColor:defaultColors["private"][0],foregroundColor:defaultColors["private"][1]}):c.backgroundColor||tabs.update(a,{backgroundColor:defaultColors.regular[0],foregroundColor:defaultColors.regular[1]});var d=tabs.getIndex(a);tabGroup.insertAt(d,createTabElement(a)),addWebview(a),b.openInBackground||(switchToTab(a),0!=b.focus&&enterEditMode(a))}function enterExpandedMode(){isExpandedMode||(dragRegion.containers=[tabDragArea],leaveTabEditMode(),tabs.get().forEach(function(a){try{var b=urlParser.prettyURL(a.url)}catch(c){var b=""}var d=getTabElement(a.id);d.find(".secondary-text").text(b)}),$(document.body).addClass("is-expanded-mode"),getWebview(tabs.getSelected()).blur(),tabContainer.get(0).focus(),isExpandedMode=!0)}function leaveExpandedMode(){isExpandedMode&&(dragRegion.containers=[],$(document.body).removeClass("is-expanded-mode"),isExpandedMode=!1)}function addPrivateTab(){if(isFocusMode)return void showFocusModeError();1==tabs.count()&&"about:blank"==tabs.getAtIndex(0).url&&destroyTab(tabs.getAtIndex(0).id);var a=tabs.getIndex(tabs.getSelected())+1,b=tabs.add({url:"about:blank","private":!0},a);addTab(b)}function showFocusModeError(){electron.remote.require("dialog").showMessageBox({type:"info",buttons:["OK"],message:"You're in focus mode.",detail:'You can leave focus mode by unchecking "focus mode" in the view menu.'})}var tabs={_state:{tabs:[],selected:null},add:function(a,b){if(!a)var a={};var c=a.id||Math.round(1e17*Math.random()),d={url:a.url||"about:blank",title:a.title||"",id:c,lastActivity:a.lastActivity||Date.now(),secure:a.secure,"private":a["private"]||!1,readerable:a.readerable||!1,backgroundColor:a.backgroundColor,foregroundColor:a.foregroundColor};return b?tabs._state.tabs.splice(b,0,d):tabs._state.tabs.push(d),c},update:function(a,b){if(!tabs.get(a))throw new ReferenceError("Attempted to update a tab that does not exist.");for(var c=-1,d=0;d<tabs._state.tabs.length;d++)tabs._state.tabs[d].id==a&&(c=d);for(var e in b){if(void 0==b[e])throw new ReferenceError("Key "+e+" is undefined.");tabs._state.tabs[c][e]=b[e]}},destroy:function(a){for(var b=0;b<tabs._state.tabs.length;b++)if(tabs._state.tabs[b].id==a)return tabs._state.tabs.splice(b,1),b;return!1},get:function(a){if(!a){for(var b=[],c=0;c<tabs._state.tabs.length;c++)b.push(JSON.parse(JSON.stringify(tabs._state.tabs[c])));return b}for(var c=0;c<tabs._state.tabs.length;c++)if(tabs._state.tabs[c].id==a)return tabs._state.tabs[c];return void 0},getIndex:function(a){for(var b=0;b<tabs._state.tabs.length;b++)if(tabs._state.tabs[b].id==a)return b;return-1},getSelected:function(){return tabs._state.selected},getAtIndex:function(a){return tabs._state.tabs[a]||void 0},setSelected:function(a){if(!tabs.get(a))throw new ReferenceError("Attempted to select a tab that does not exist.");tabs._state.selected=a},count:function(){return tabs._state.tabs.length},reorder:function(a){tabs._state.tabs.sort(function(b,c){return a.indexOf(b.id)-a.indexOf(c.id)})}},urlParser={searchBaseURL:"https://duckduckgo.com/?q=%s",startingWWWRegex:/www\.(.+\..+\/)/g,trailingSlashRegex:/\/$/g,isURL:function(a){return 0==a.indexOf("http://")||0==a.indexOf("https://")||0==a.indexOf("file://")||0==a.indexOf("about:")||0==a.indexOf("chrome:")||0==a.indexOf("data:")},isSystemURL:function(a){return 0==a.indexOf("chrome")||0==a.indexOf("about:")},removeProtocol:function(a){if(!urlParser.isURL(a))return a;var b=a.replace("http://","").replace("https://","").replace("file://","");return 0==b.indexOf("www.")?b.replace("www.",""):b},isURLMissingProtocol:function(a){return-1==a.indexOf(" ")&&a.indexOf(".")>0},parse:function(a){if(a=a.trim(),!a)return"";if(urlParser.isURL(a))return a;if(0==a.indexOf("view-source:")){var b=a.replace("view-source:","");return"view-source:"+urlParser.parse(b)}return urlParser.isURLMissingProtocol(a)?"http://"+a:urlParser.searchBaseURL.replace("%s",encodeURIComponent(a))},prettyURL:function(a){var b=new URL(a);return(b.hostname+b.pathname).replace(urlParser.startingWWWRegex,"$1").replace(urlParser.trailingSlashRegex,"")},areEqual:function(a,b){try{var c=new URL(a),d=new URL(b);return c.hostname==d.hostname&&c.pathname==d.pathname}catch(e){return a==b}}},phishingWarningPage="file://"+__dirname+"/pages/phishing/index.html",crashedWebviewPage="file:///"+__dirname+"/pages/crash/index.html",errorPage="file:///"+__dirname+"/pages/error/index.html",webviewBase=$("#webviews"),webviewEvents=[],webviewIPC=[],WebviewsWithHiddenClass=!1,remote,Menu,MenuItem,clipboard,webviewMenu={cache:{event:null,webview:null},loadFromContextData:function(a){var b=tabs.get(tabs.getSelected()),c=webviewMenu.cache.event,d=new Menu;if(a.src&&!isFocusMode){if(a.src.length>60)var e=a.src.substring(0,60)+"...";else var e=a.src;d.append(new MenuItem({label:e,enabled:!1})),d.append(new MenuItem({label:"Open in New Tab",click:function(){var c=tabs.add({url:a.src,"private":b["private"]},tabs.getIndex(tabs.getSelected())+1);addTab(c,{focus:!1})}})),b["private"]||d.append(new MenuItem({label:"Open in New Private Tab",click:function(){var b=tabs.add({url:a.src,"private":!0},tabs.getIndex(tabs.getSelected())+1);addTab(b,{focus:!1})}})),d.append(new MenuItem({type:"separator"})),d.append(new MenuItem({label:"Copy link",click:function(){clipboard.writeText(a.src)}}))}a.selection&&(d.append(new MenuItem({label:"Copy",click:function(){clipboard.writeText(a.selection)}})),d.append(new MenuItem({type:"separator"})),d.append(new MenuItem({label:"Search with DuckDuckGo",click:function(){var c=tabs.add({url:"https://duckduckgo.com/?q="+encodeURIComponent(a.selection),"private":b["private"]});addTab(c,{focus:!1})}}))),a.image&&d.append(new MenuItem({label:"View image",click:function(){navigate(webviewMenu.cache.tab,a.image)}})),d.append(new MenuItem({label:"Inspect Element",click:function(){webviewMenu.cache.webview.inspectElement(c.x,c.y)}})),d.popup(remote.getCurrentWindow())},show:function(a){remote||(remote=require("remote"),Menu=remote.require("menu"),MenuItem=remote.require("menu-item"),clipboard=require("clipboard"));var b=a.originalEvent||a;webviewMenu.cache.event=b;var c=tabs.getSelected(),d=getWebview(c)[0];webviewMenu.cache.tab=c,webviewMenu.cache.webview=d,d.send("getContextData",{x:b.offsetX,y:b.offsetY})}};bindWebviewIPC("contextData",function(a,b,c){webviewMenu.loadFromContextData(c[0])});var bookmarks={authBookmarkTab:null,updateHistory:function(a){setTimeout(function(){var b=tabs.get(a);if(b){var c={url:b.url,title:b.title,color:b.backgroundColor};bookmarks.historyWorker.postMessage({action:"updateHistory",data:c})}},2e3)},currentCallback:function(){},onDataRecieved:function(a){if(!bookmarks.authBookmarkTab||getWebview(bookmarks.authBookmarkTab)[0].getURL()!=a.url)throw new Error("Bookmark operation is unauthoritized.");a.title=getWebview(bookmarks.authBookmarkTab)[0].getTitle(),bookmarks.bookmarksWorker.postMessage({action:"addBookmark",data:a}),bookmarks.authBookmarkTab=null},deleteBookmark:function(a){bookmarks.bookmarksWorker.postMessage({action:"deleteBookmark",data:{url:a}})},deleteHistory:function(a){bookmarks.historyWorker.postMessage({action:"deleteHistory",data:{url:a}})},searchBookmarks:function(a,b){bookmarks.currentCallback=b,bookmarks.bookmarksWorker.postMessage({action:"searchBookmarks",text:a})},searchHistory:function(a,b){bookmarks.currentHistoryCallback=b,bookmarks.historyWorker.postMessage({action:"searchHistory",text:a})},onMessage:function(a){"bookmarks"==a.data.scope?bookmarks.currentCallback(a.data.result):"history"==a.data.scope&&bookmarks.currentHistoryCallback(a.data.result)},bookmark:function(a){bookmarks.authBookmarkTab=a,getWebview(a)[0].send("sendData")},toggleBookmarked:function(a){var b=tabs.get(a).url,c=!1;bookmarks.searchBookmarks(b,function(d){d.forEach(function(a){a.url==b&&(c=!0)}),c?(console.log("deleting bookmark "+tabs.get(a).url),bookmarks.deleteBookmark(tabs.get(a).url)):bookmarks.bookmark(a)})},getStar:function(a){var b=$("<i class='fa fa-star-o bookmarks-button theme-text-color'>").attr("data-tab",a);return b.on("click",function(a){$(this).toggleClass("fa-star").toggleClass("fa-star-o"),bookmarks.toggleBookmarked($(this).attr("data-tab"))}),bookmarks.renderStar(a,b)},renderStar:function(a,b){b=b||$('.bookmarks-button[data-tab="{id}"]'.replace("{id}",a));var c=tabs.get(a).url;return c&&"about:blank"!=c?b.prop("hidden",!1):b.prop("hidden",!0),bookmarks.searchBookmarks(c,function(a){a&&a[0]&&a[0].url==c?b.removeClass("fa-star-o").addClass("fa-star"):b.removeClass("fa-star").addClass("fa-star-o")}),b},init:function(){bookmarks.historyWorker=new Worker("js/bookmarkshistory/historyworker.js"),bookmarks.historyWorker.onmessage=bookmarks.onMessage,bookmarks.bookmarksWorker=new Worker("js/bookmarkshistory/bookmarksworker.js"),bookmarks.bookmarksWorker.onmessage=bookmarks.onMessage}};bookmarks.init();var DDGSearchURLRegex=/^https:\/\/duckduckgo.com\/\?q=([^&]*).*/g,trailingSlashRegex=/\/$/g,plusRegex=/\+/g,currentACItem=null,deleteKeyPressed=!1,maxHistoryResults=4,showHistoryResults=throttle(function(a,b,c){(a||!b[0].value)&&(a&&(a=a.trim()),bookmarks.searchHistory(a,function(d){var e=!1;c=c||maxHistoryResults,a||(c=4),historyarea.empty(),topAnswerarea.get(0).getElementsByClassName("history-item").length>0&&topAnswerarea.empty(),searchbarAutocomplete(a,b,d),d.length<10?(limitSearchSuggestions(d.length),c=3,showSearchSuggestions(a,b)):-1==a.indexOf("!")&&serarea.empty();var f=0;if(d=d.splice(0,5),d.forEach(function(b){var d=!1,g=b.title,h=$("<i class='fa fa-globe'>");if(DDGSearchURLRegex.lastIndex=0,DDGSearchURLRegex.test(b.url)&&(g=decodeURIComponent(b.url.replace(DDGSearchURLRegex,"$1").replace(plusRegex," ")),h=$("<i class='fa fa-search'>"),d=!0),d||0!=a.indexOf("!")){var i=$("<div class='result-item history-item' tabindex='-1'>").append($("<span class='title'>").text(getRealTitle(g))).on("click",function(a){openURLFromsearchbar(a,b.url)});i.attr("data-url",b.url),h.prependTo(i),d||b.title==b.url||$("<span class='secondary-text'>").text(urlParser.prettyURL(b.url)).appendTo(i),f>=c&&i.prop("hidden",!0).addClass("unfocusable"),urlParser.areEqual(currentACItem,b.url)&&c>f&&!e?(i.addClass("fakefocus"),requestAnimationFrame(function(){i.appendTo(topAnswerarea)}),e=!0):requestAnimationFrame(function(){i.appendTo(historyarea)}),f++}}),currentACItem&&!e){var g=$("<div class='result-item history-item fakefocus' tabindex='-1'>").append($("<span class='title'>").text(urlParser.prettyURL(currentACItem))).on("click",function(a){openURLFromsearchbar(a,currentACItem)});$("<i class='fa fa-globe'>").prependTo(g),requestAnimationFrame(function(){g.appendTo(topAnswerarea)})}}))},50),showBookmarkResults=throttle(function(a){return a.length<5||0==a.indexOf("!")?(limitHistoryResults(5),void bookmarkarea.empty()):void bookmarks.searchBookmarks(a,function(b){bookmarkarea.empty();var c=1;b.splice(0,2).forEach(function(b){b.score>Math.max(4e-4,.0016-12e-5*Math.pow(1.25,a.length))&&(1==c||a.length>6)&&(requestAnimationFrame(function(){addBookmarkItem(b)}),c++)}),limitHistoryResults(5-c)})},400),showAllBookmarks=function(){bookmarks.searchBookmarks("",function(a){a.sort(function(a,b){return a.url<b.url?-1:a.url>b.url?1:0}),a.forEach(addBookmarkItem)})},BANG_REGEX=/!\w+/g,serarea=$("#searchbar .search-engine-results"),iaarea=$("#searchbar .instant-answer-results"),topAnswerarea=$("#searchbar .top-answer-results"),suggestedsitearea=$("#searchbar .ddg-site-results");const minSearchSuggestions=2,maxSearchSuggestions=4;var currentSuggestionLimit=maxSearchSuggestions,IAFormats={color_code:function(a,b){var c=[b.data.rgb,b.data.hslc,b.data.cmyb];-1==a.indexOf("#")&&c.unshift(b.data.hexc);var d=$("<div class='result-item indent' tabindex='-1'>");return $("<span class='title'>").text(a).appendTo(d),$("<div class='result-icon color-circle'>").css("background-color","#"+b.data.hex_code).prependTo(d),$("<span class='description-block'>").text(c.join(" "+METADATA_SEPARATOR+" ")).appendTo(d),d},minecraft:function(a,b){var c=$("<div class='result-item indent' tabindex='-1'>");return $("<span class='title'>").text(b.data.title).appendTo(c),$("<img class='result-icon image'>").attr("src",b.data.image).prependTo(c),$("<span class='description-block'>").text(b.data.description+" "+b.data.subtitle).appendTo(c),c},figlet:function(a,b){var c=removeTags(b).replace("Font: standard",""),d=$("<div class='result-item indent' tabindex='-1'>"),e=$("<span class='description-block'>").text(c).appendTo(d);return e.css({"white-space":"pre-wrap","font-family":"monospace","max-height":"10em","-webkit-user-select":"auto"}),d}};window.showSearchSuggestions=throttle(function(a,b){if(a&&!tabs.get(tabs.getSelected())["private"]){if(BANG_REGEX.test(a))var c=a.match(BANG_REGEX)[0],d=cachedBangSnippets[c];$.ajax("https://ac.duckduckgo.com/ac/?q="+encodeURIComponent(a)).done(function(a){serarea.find(".result-item").addClass("old"),a&&a[0]&&a[0].snippet?a.splice(0,5).forEach(function(a){cachedBangSnippets[a.phrase]=a.snippet;var c=$("<div class='result-item' tabindex='-1'>").append($("<span class='title'>").text(a.snippet)).on("click",function(){setTimeout(function(){b.val(a.phrase+" ").get(0).focus()},100)});$("<span class='secondary-text'>").text(a.phrase).appendTo(c),$("<img class='result-icon inline'>").attr("src",a.image).prependTo(c),c.appendTo(serarea)}):a&&(a=a.splice(0,currentSuggestionLimit),a.forEach(function(a){var b=a.phrase;if(BANG_REGEX.test(a.phrase)&&d){b=a.phrase.replace(BANG_REGEX,"");var c="Search on "+d}var e=$("<div class='result-item iadata-onfocus' tabindex='-1'>").append($("<span class='title'>").text(b)).on("click",function(b){openURLFromsearchbar(b,a.phrase)});e.appendTo(serarea),urlParser.isURL(a.phrase)||urlParser.isURLMissingProtocol(a.phrase)?$("<i class='fa fa-globe'>").prependTo(e):$("<i class='fa fa-search'>").prependTo(e),c&&$("<span class='secondary-text'>").text(c).appendTo(e)})),serarea.find(".old").remove()})}},500);var limitSearchSuggestions=function(a){var b=Math.max(minSearchSuggestions,maxSearchSuggestions-a);currentSuggestionLimit=b,serarea.find(".result-item:nth-child(n+{items})".replace("{items}",b+1)).remove()};window.showInstantAnswers=debounce(function(a,b,c){return a?(c=c||{},void(urlParser.isURLMissingProtocol(a)||tabs.get(tabs.getSelected())["private"]||(iaarea.find(".result-item").addClass("old"),suggestedsitearea.find(".result-item").addClass("old"),a.length>3?$.getJSON("https://api.duckduckgo.com/?skip_disambig=1&format=json&q="+encodeURIComponent(a),function(d){if(a==getValue(b)||c.alwaysShow){if(iaarea.find(".result-item").addClass("old"),suggestedsitearea.find(".result-item").addClass("old"),IAFormats[d.AnswerType])e=IAFormats[d.AnswerType](a,d.Answer);else if(d.Abstract||d.Answer){var e=$("<div class='result-item indent' tabindex='-1'>");d.Answer?e.text(removeTags(d.Answer)):e.text(d.Heading),d.Image&&!d.ImageIsLogo&&$("<img class='result-icon image low-priority-image'>").attr("src",d.Image).prependTo(e),$("<span class='description-block'>").text(removeTags(d.Abstract)||"Answer").appendTo(e)}if(e&&(e.on("click",function(b){openURLFromsearchbar(b,d.AbstractURL||a)}),d.Answer?(topAnswerarea.empty(),e.appendTo(topAnswerarea)):e.appendTo(iaarea)),d.Results&&d.Results[0]&&d.Results[0].FirstURL){var f=historyarea.find('.result-item[data-url="{url}"]'.replace("{url}",d.Results[0].FirstURL));if(0==f.length){var g=urlParser.removeProtocol(d.Results[0].FirstURL).replace(trailingSlashRegex,""),e=$("<div class='result-item' tabindex='-1'>").append($("<span class='title'>").text(g)).on("click",function(a){openURLFromsearchbar(a,d.Results[0].FirstURL)});$("<i class='fa fa-globe'>").prependTo(e),$("<span class='secondary-text'>").text("Suggested site").appendTo(e),e.appendTo(suggestedsitearea)}}var h=["location","country","u.s. state","protected area"];if(-1!=h.indexOf(d.Entity)){var e=$("<div class='result-item' tabindex='-1'>");$("<i class='fa fa-search'>").appendTo(e),$("<span class='title'>").text(d.Heading).appendTo(e),$("<span class='secondary-text'>Search on OpenStreetMap</span>").appendTo(e),e.on("click",function(a){openURLFromsearchbar(a,"https://www.openstreetmap.org/search?query="+encodeURIComponent(d.Heading))}),e.prependTo(iaarea)}(0!=c.destroyPrevious||e)&&(iaarea.find(".old").remove(),suggestedsitearea.find(".old").remove())}}):(iaarea.find(".old").remove(),suggestedsitearea.find(".old").remove())))):(iaarea.empty(),void suggestedsitearea.empty())},450);var spacesRegex=/[\s._\/-]/g,stringScore=require("string_score"),searchOpenTabs=function(a){if(opentabarea.empty(),!(a.length<3)){var b=[],c=tabs.getSelected();tabs.get().forEach(function(d){if(d.id!=c&&d.title&&"about:blank"!=d.url){d.url=urlParser.removeProtocol(d.url);var e=-1!=d.title.indexOf(a)||-1!=d.url.indexOf(a),f=d.title.substring(0,50).score(a,.5)>.4||d.url.score(a,.5)>.4;(e||f)&&b.push(d)}}),b.splice(0,2).sort(function(b,c){return c.title.score(a,.5)-b.title.score(a,.5)}).forEach(function(a){var b=$("<div class='result-item' tabindex='-1'>").append($("<span class='title'>").text(a.title));$("<span class='secondary-text'>").text(urlParser.removeProtocol(a.url).replace(trailingSlashRegex,"")).appendTo(b),$("<i class='fa fa-external-link-square'>").attr("title","Switch to Tab").prependTo(b),b.on("click",function(){"about:blank"==tabs.get(tabs.getSelected()).url&&destroyTab(tabs.getSelected(),{switchToTab:!1}),switchToTab(a.id)}),b.appendTo(opentabarea)})}},searchbarCachedText="",METADATA_SEPARATOR="Â·",didFireKeydownSelChange=!1,currentsearchbarInput,cachedBangSnippets={},searchbar=$("#searchbar"),historyarea=searchbar.find(".history-results"),bookmarkarea=searchbar.find(".bookmark-results"),opentabarea=searchbar.find(".opentab-results"),showSearchbarResults=function(a,b,c){if(!c||!c.metaKey){deleteKeyPressed=c&&8==c.keyCode;var d=b[0].value;if(c&&8!=c.keyCode?a=d.substring(0,b[0].selectionStart)+String.fromCharCode(c.keyCode)+d.substring(b[0].selectionEnd+1,d.length).trim():txt=d,console.log("searchbar: ","'"+a+"'",a.length),a.length<1)return showHistoryResults("",b),void clearsearchbar();if(0==a.indexOf("?"))return clearsearchbar(),maxSearchSuggestions=5,void showSearchSuggestions(a.replace("?",""),b);if(0==a.indexOf("^"))return clearsearchbar(),void showHistoryResults(a.replace("^",""),b);if(0==a.indexOf("*"))return clearsearchbar(),void showBookmarkResults(a.replace("*",""),b);0==a.indexOf("!")&&showSearchSuggestions(a,b),showBookmarkResults(a),showHistoryResults(a,b),showInstantAnswers(a,b),searchOpenTabs(a,b),searchbarCachedText=a}};searchbar.on("keydown",".result-item",function(a){13==a.keyCode?$(this).trigger("click"):9==a.keyCode||40==a.keyCode?(a.preventDefault(),focussearchbarItem()):38==a.keyCode&&(a.preventDefault(),focussearchbarItem({focusPrevious:!0}))});var lastItemDeletion=Date.now();searchbar.on("mousewheel",".history-results .result-item, .top-answer-results .result-item",function(a){var b=$(this);a.originalEvent.deltaX>50&&a.originalEvent.deltaY<3&&b.attr("data-url")&&Date.now()-lastItemDeletion>700&&(lastItemDeletion=Date.now(),b.animate({opacity:"0","margin-left":"-100%"},200,function(){b.remove(),bookmarks.deleteHistory(b.attr("data-url")),lastItemDeletion=Date.now()}))}),bindWebviewIPC("keywordsData",function(a,b,c){var d=c[0],e=0,f=[];d.entities.forEach(function(a,b){if(/\s/g.test(a.trim())&&!(e>=5||-1!=f.indexOf(a.trim()))){var c=$("<div class='result-item iadata-onfocus' tabindex='-1'>").append($("<span class='title'>").text(a)).on("click",function(b){b.metaKey?openURLInBackground(a):navigate(tabs.getSelected(),a)});$("<i class='fa fa-search'>").prependTo(c),c.appendTo(serarea),e++,f.push(a.trim())}})});var readerView={
readerURL:"file://"+__dirname+"/reader/index.html",getButton:function(a){return $("<i class='fa fa-align-left reader-button'>").attr("data-tab",a).attr("title","Enter reader view")},updateButton:function(a){var b=$('.reader-button[data-tab="{id}"]'.replace("{id}",a)),c=tabs.get(a);return b.off(),c.isReaderView?(b.addClass("is-reader").attr("title","Exit reader view"),void b.on("click",function(b){b.stopPropagation(),readerView.exit(a)})):(b.removeClass("is-reader").attr("title","Enter reader view"),void(c.readerable?(b.addClass("can-reader"),b.on("click",function(b){b.stopPropagation(),readerView.enter(a)})):b.removeClass("can-reader")))},enter:function(a){navigate(a,readerView.readerURL+"?url="+tabs.get(a).url),tabs.update(a,{isReaderView:!0})},exit:function(a){navigate(a,tabs.get(a).url.split("?url=")[1]),tabs.update(a,{isReaderView:!1})}};bindWebviewEvent("did-finish-load",function(a){var b=$(this).attr("data-tab"),c=$(this).attr("src");0==c.indexOf(readerView.readerURL)?tabs.update(b,{isReaderView:!0}):tabs.update(b,{isReaderView:!1}),tabs.update(b,{readerable:!1}),readerView.updateButton(b)}),bindWebviewIPC("canReader",function(a,b){tabs.update(b,{readerable:!0}),readerView.updateButton(b)});var tabActivity={minFadeAge:33e4,refresh:function(){requestAnimationFrame(function(){var a=tabs.get(),b=tabs.getSelected(),c=Date.now();a.forEach(function(a){return b==a.id?void getTabElement(a.id).removeClass("fade"):void(c-a.lastActivity>tabActivity.minFadeAge?getTabElement(a.id).addClass("fade"):getTabElement(a.id).removeClass("fade"))})})},init:function(){setInterval(tabActivity.refresh,7500)}};tabActivity.init();var colorExtractorImage=document.createElement("img");const defaultColors={"private":["rgb(58, 44, 99)","white"],regular:["rgb(255, 255, 255)","black"]};var hours=(new Date).getHours()+(new Date).getMinutes()/60;setInterval(function(){var a=new Date;hours=a.getHours()+a.getMinutes()/60},24e4);var getTextColor=function(a){var b=runNetwork(a);return b.black>.5?"black":"white"},runNetwork=function(a){for(var b={layers:[{r:{},g:{},b:{}},{0:{bias:14.176907520571566,weights:{r:-3.2764240497480652,g:-16.90247884718719,b:-2.9976364179397814}},1:{bias:9.086071102351246,weights:{r:-4.327474143397604,g:-15.780660155750773,b:2.879230202567851}},2:{bias:22.274487339773476,weights:{r:-3.5830205067960965,g:-25.498384261673618,b:-6.998329189107962}}},{black:{bias:17.873962570788997,weights:{0:-15.542217788633987,1:-13.377152708685674,2:-24.52215186113144}}}],outputLookup:!0,inputLookup:!0},c=1;c<b.layers.length;c++){var d=b.layers[c],e={};for(var f in d){var g=d[f],h=g.bias;for(var i in g.weights)h+=g.weights[i]*a[i];e[f]=1/(1+Math.exp(-h))}a=e}return e};jQuery.fn.insertAt=function(a,b){var c=this.children().size();return 0>a&&(a=Math.max(0,c+1+a)),this.append(b),c>a&&this.children().eq(a).before(this.children().last()),this};var tabContainer=$(".tab-group"),tabGroup=$(".tab-group #tabs"),lastTabDeletion=0;tabGroup.on("mousewheel",".tab-item",function(a){if(a.originalEvent.deltaY>65&&a.originalEvent.deltaX<10&&Date.now()-lastTabDeletion>650){if(lastTabDeletion=Date.now(),isFocusMode)return void showFocusModeError();var b=$(this).attr("data-tab");getTabElement(b).animate({"margin-top":"-40px"},125,function(){if(b==tabs.getSelected()){var a=tabs.getIndex(tabs.getSelected()),c=tabs.getAtIndex(a+1)||tabs.getAtIndex(a-1);destroyTab(b),c?switchToTab(c.id):addTab()}else destroyTab(b)})}a.originalEvent.deltaY>0&&a.stopPropagation()}),tabGroup.on("click",".tab-item",function(a){var b=$(this).attr("data-tab");tabs.getSelected()!=b?switchToTab(b):isExpandedMode||enterEditMode(b)}),$.fn.getInput=function(){return this.find(".tab-input")},bindWebviewEvent("focus",function(){leaveExpandedMode(),leaveTabEditMode()});var tabDragArea=tabGroup[0];require.async("dragula",function(a){window.dragRegion=a(),dragRegion.on("drop",function(){var a=[];tabContainer.find(".tab-item").each(function(){var b=parseInt($(this).attr("data-tab"));a.push(b)}),tabs.reorder(a)})}),tabContainer.on("mousewheel",function(a){a.originalEvent.deltaY<-30&&a.originalEvent.deltaX<10?(enterExpandedMode(),a.stopImmediatePropagation()):a.originalEvent.deltaY>70&&a.originalEvent.deltaX<10&&leaveExpandedMode()}),tabContainer.on("mouseenter",".tab-item",function(a){if(isExpandedMode){var b=$(this);setTimeout(function(){if(b.is(":hover")){tabs.get(b.attr("data-tab"));switchToTab(b.attr("data-tab"))}},125)}});var isExpandedMode=!1;tabContainer.on("click",".tab-item",function(){isExpandedMode&&(leaveExpandedMode(),getWebview(tabs.getSelected())[0].focus())});var addTabButton=$(".add-tab");addTabButton.on("click",function(a){var b=tabs.add({},tabs.getIndex(tabs.getSelected())+1);addTab(b)}),ipc.on("zoomIn",function(){getWebview(tabs.getSelected())[0].send("zoomIn")}),ipc.on("zoomOut",function(){getWebview(tabs.getSelected())[0].send("zoomOut")}),ipc.on("zoomReset",function(){getWebview(tabs.getSelected())[0].send("zoomReset")}),ipc.on("print",function(){getWebview(tabs.getSelected())[0].print()}),ipc.on("inspectPage",function(){getWebview(tabs.getSelected())[0].openDevTools()}),ipc.on("addTab",function(a){if(isFocusMode)return void showFocusModeError();var b=tabs.getIndex(tabs.getSelected())+1,c=tabs.add({},b);addTab(c)}),ipc.on("addPrivateTab",addPrivateTab),require.async("mousetrap",function(a){window.Mousetrap=a,a.bind("shift+command+p",addPrivateTab),a.bind(["command+l","command+k"],function(a){return enterEditMode(tabs.getSelected()),!1}),a.bind("command+w",function(a){if(a.preventDefault(),a.stopImmediatePropagation(),isFocusMode)return void showFocusModeError();var b=tabs.getSelected(),c=tabs.getIndex(b),d=tabs.getAtIndex(c+1)||tabs.getAtIndex(c-1);return destroyTab(b),d?switchToTab(d.id):addTab(),1==tabs.count()&&leaveExpandedMode(),!1}),a.bind("command+d",function(a){getTabElement(tabs.getSelected()).find(".bookmarks-button").click()}),a.bind("command+f",function(a){findinpage.toggle()});for(var b=1;9>b;b++)!function(b){a.bind("command+"+b,function(a){var c=tabs.getIndex(tabs.getSelected()),d=tabs.getAtIndex(c+b)||tabs.getAtIndex(c-b);d&&switchToTab(d.id)}),a.bind("shift+command+"+b,function(a){var c=tabs.getIndex(tabs.getSelected()),d=tabs.getAtIndex(c-b)||tabs.getAtIndex(c+b);d&&switchToTab(d.id)})}(b);a.bind("command+9",function(a){switchToTab(tabs.getAtIndex(tabs.count()-1).id)}),a.bind("shift+command+9",function(a){switchToTab(tabs.getAtIndex(0).id)}),a.bind("esc",function(a){leaveTabEditMode(),leaveExpandedMode(),getWebview(tabs.getSelected()).get(0).focus()}),a.bind("shift+command+r",function(){getTabElement(tabs.getSelected()).find(".reader-button").trigger("click")}),a.bind("command+left",function(a){getWebview(tabs.getSelected())[0].goBack()}),a.bind("command+right",function(a){getWebview(tabs.getSelected())[0].goForward()}),a.bind(["option+command+left","shift+ctrl+tab"],function(a){enterExpandedMode();var b=tabs.getIndex(tabs.getSelected()),c=tabs.getAtIndex(b-1);switchToTab(c?c.id:tabs.getAtIndex(tabs.count()-1).id)}),a.bind(["option+command+right","ctrl+tab"],function(a){enterExpandedMode();var b=tabs.getIndex(tabs.getSelected()),c=tabs.getAtIndex(b+1);switchToTab(c?c.id:tabs.getAtIndex(0).id)}),a.bind("command+n",function(a){for(var b=tabs.get(),c=0;c<b.length;c++)destroyTab(b[c].id);addTab()}),a.bind("return",function(){isExpandedMode&&(leaveExpandedMode(),getWebview(tabs.getSelected())[0].focus())}),a.bind("shift+command+e",function(){isExpandedMode?leaveExpandedMode():enterExpandedMode()}),a.bind("shift+command+b",function(){clearsearchbar(),showSearchbar(getTabElement(tabs.getSelected()).getInput()),enterEditMode(tabs.getSelected()),showAllBookmarks()})}),$(document.body).on("keyup",function(a){17==a.keyCode&&leaveExpandedMode()});var PDFViewerURL="file://"+__dirname+"/pdfjs/web/viewer.html?url=";ipc.on("openPDF",function(a,b){console.log("opening PDF",b);var c=PDFViewerURL+b.url,d=!1;if(tabs.get().forEach(function(a){a.url==b.url&&(navigate(a.id,c),d=!0)}),!d){var e=tabs.add({url:c},tabs.getIndex(tabs.getSelected())+1);addTab(e,{focus:!1})}});var findinpage={container:$("#findinpage-bar"),input:$("#findinpage-bar .findinpage-input"),isEnabled:!1,start:function(a){findinpage.container.prop("hidden",!1),findinpage.isEnabled=!0,findinpage.input.focus().select()},end:function(a){findinpage.container.prop("hidden",!0),a&&0!=a.blurInput&&findinpage.input.blur(),findinpage.isEnabled=!1,findinpage.input.is(":focus")&&getWebview(tabs.getSelected()).get(0).focus()},toggle:function(){findinpage.isEnabled?findinpage.end():findinpage.start()},escape:function(a){return a.replace(/'/g,"\\'")}};findinpage.input.on("keyup",function(a){if(27==a.keyCode)return void findinpage.end();var b=findinpage.escape($(this).val()),c=getWebview(tabs.getSelected())[0];13!=a.keyCode&&c.executeJavaScript("window.getSelection().empty()"),c.executeJavaScript("find('{t}', false, false, true, false, false, false)".replace("{t}",b))}),findinpage.input.on("blur",function(a){findinpage.end({blurInput:!1})});var sessionRestore={save:function(){requestIdleCallback(function(){var a={version:1,tabs:[],selected:tabs._state.selected};tabs.get().forEach(function(b){b["private"]||a.tabs.push(b)}),localStorage.setItem("sessionrestoredata",JSON.stringify(a))},{timeout:2250})},restore:function(){try{var a=JSON.parse(localStorage.getItem("sessionrestoredata")||"{}");if(localStorage.setItem("sessionrestoredata","{}"),a.version&&1!=a.version)return void addTab({leaveEditMode:!1});if(console.info("restoring tabs",a.tabs),!a||!a.tabs||!a.tabs.length||1==a.tabs.length&&"about:blank"==a.tabs[0].url)return void addTab(tabs.add(),{leaveEditMode:!1});a.tabs.forEach(function(a,b){var c=tabs.add(a);addTab(c,{openInBackground:!0,leaveEditMode:!1})}),switchToTab(tabs.get(a.selected)?a.selected:a.tabs[0].id)}catch(b){console.warn("failed to restore session, rolling back"),console.error(b),localStorage.setItem("sessionrestoredata","{}"),$("webview, .tab-item").remove(),addTab()}}};sessionRestore.restore(),setInterval(sessionRestore.save,12500);var isFocusMode=!1;ipc.on("enterFocusMode",function(){isFocusMode=!0,$(document.body).addClass("is-focus-mode"),setTimeout(function(){electron.remote.require("dialog").showMessageBox({type:"info",buttons:["OK"],message:"You're in focus mode.",detail:'In focus mode, all tabs except the current one are hidden, and you can\'t create new tabs. You can leave focus mode by unchecking "focus mode" from the view menu.'})},16)}),ipc.on("exitFocusMode",function(){isFocusMode=!1,$(document.body).removeClass("is-focus-mode")});